<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© - Ø£ØµÙØ±ÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Tajawal', sans-serif; overflow: hidden; background-color: #f0f2f5; transition: background 1s ease; }
    body.morning { background: linear-gradient(135deg, #e0f7fa, #81d4fa); }
    body.sunrise { background: linear-gradient(135deg, #fff3e0, #ffe0b2); }
    body.day { background: linear-gradient(135deg, #f0f2f5, #e3f2fd); }
    body.sunset { background: linear-gradient(135deg, #f3e5f5, #e1bee7); }
    body.night { background: linear-gradient(135deg, #eceff1, #cfd8dc); }

    .container { width: 100%; height: 100%; display: flex; flex-direction: column; padding: 10px 15px 0 15px; max-width: 500px; margin: 0 auto; position: relative; }
    .header-row { display: flex; justify-content: space-between; align-items: center; flex: 0 0 auto; margin-bottom: 5px; }
    .tool-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #555; padding: 5px; }
    .header-section { text-align: center; flex: 1; }
    h1 { color: #2c3e50; font-size: 1.4em; margin: 0; font-weight: 900; }
    .city-subtitle { font-size: 0.9em; color: #7f8c8d; }

    .countdown-box { flex: 0 0 auto; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 10px; border-radius: 15px; margin-bottom: 10px; text-align: center; box-shadow: 0 5px 15px rgba(199, 56, 43, 0.2); }
    .next-prayer-name { font-size: 1.8em; font-weight: 900; margin: 0; }
    .timer-display { font-size: 2.5em; font-weight: 800; font-family: monospace; direction: ltr; }

    .tabs { display: flex; gap: 8px; margin-bottom: 5px; flex: 0 0 auto; }
    .tab-btn { flex: 1; background: rgba(255,255,255,0.6); border: none; padding: 8px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    .tab-btn.active { background: #2c3e50; color: white; }

    .input-group { display: none; width: 100%; margin-bottom: 5px; }
    input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; text-align: center; }

    #prayers-list-container { flex: 1; overflow-y: auto; background: rgba(255,255,255,0.6); border-radius: 15px 15px 0 0; padding-bottom: 140px; }
    .prayer-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .highlight-row { background-color: #fff8e1; border-left: 5px solid #f39c12; }
    .time { color: #27ae60; font-weight: bold; font-size: 1.1em; }

    .bottom-actions { position: absolute; bottom: 85px; left: 0; right: 0; display: flex; flex-direction: column; align-items: center; gap: 10px; z-index: 100; }
    .btn-ramadan { background: linear-gradient(45deg, #d4af37, #f1c40f); color: #0a1a3a !important; text-decoration: none; padding: 10px 20px; border-radius: 50px; font-weight: bold; font-size: 0.9em; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); border: 1px solid #fff; animation: pulse 2s infinite; }
    .btn-fab { background: linear-gradient(45deg, #8e44ad, #9b59b6); color: white; border: none; padding: 10px 35px; border-radius: 50px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }

    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    .night-info-box { flex: 0 0 auto; padding: 12px; background-color: #2c3e50; color: #ecf0f1; border-radius: 15px 15px 0 0; font-size: 0.8em; display: flex; justify-content: space-around; align-items: center; margin: 0 -15px; z-index: 50; }
    .night-val { color: #f1c40f; font-weight: bold; font-size: 1.1em; }

    .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
    .modal-content { background-color: white; position: absolute; bottom: 0; width: 100%; max-height: 70vh; overflow-y: auto; border-radius: 25px 25px 0 0; padding: 25px; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .close-modal { float: left; background: #f0f0f0; width: 35px; height: 35px; border-radius: 50%; text-align: center; line-height: 35px; cursor: pointer; }
  </style>
</head>
<body>
  <audio id="adhanAudio" src="https://media.sd.ma/assabile/adhan/3849/03849.mp3" preload="auto"></audio>
  <div class="container">
    <div class="header-row">
      <button class="tool-btn" onclick="openModal('settingsModal')">âš™ï¸</button>
      <div class="header-section"><h1>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1><div id="city-subtitle" class="city-subtitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</div></div>
      <button class="tool-btn" onclick="toggleSound()" id="soundBtn">ğŸ”Š</button>
    </div>
    <div id="countdown-area" class="countdown-box" style="display:none;"><div id="next-prayer-name" style="font-size: 0.8em; opacity: 0.9;">Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰</div><div id="p-name" class="next-prayer-name">...</div><div id="timer" class="timer-display">00:00:00</div></div>
    <div class="tabs"><button class="tab-btn active" onclick="switchMode('auto')" id="btn-auto">Ù…ÙˆÙ‚Ø¹ÙŠ</button><button class="tab-btn" onclick="switchMode('manual')" id="btn-manual">Ø¨Ø­Ø« ÙŠØ¯ÙˆÙŠ</button></div>
    <div id="manual-input" class="input-group"><input type="text" id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"><input type="text" id="country" placeholder="Ø§Ù„Ø¯ÙˆÙ„Ø©"><button class="tab-btn active" style="width:100%; margin-top:5px; background:#27ae60; color:white;" onclick="runManualSearch()">Ø¨Ø­Ø«</button></div>
    <div id="date-area" style="text-align:center; font-size:0.8em; margin-bottom:5px; color:#555;"></div>
    <div id="prayers-list-container"><div id="prayers-list-content"></div></div>
    <div class="bottom-actions">
      <a href="ramadan.html" class="btn-ramadan">ğŸŒ™ Ø¨Ø·Ø§Ù‚Ø© ØªÙ‡Ù†Ø¦Ø© Ø¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù†</a>
      <button class="btn-fab" onclick="openModal('adhkarModal')">ğŸ“¿ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
    </div>
    <div id="night-area" class="night-info-box">
      <div class="night-item"><span style="display:block; color:#bbb;">Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„</span><span id="midnight-time" class="night-val">--:--</span></div>
      <div class="night-item"><span style="display:block; color:#bbb;">Ø§Ù„Ø«Ù„Ø« Ø§Ù„Ø£Ø®ÙŠØ±</span><span id="last-third-time" class="night-val">--:--</span></div>
    </div>
  </div>

  <div id="adhkarModal" class="modal"><div class="modal-content"><span class="close-modal" onclick="closeModal('adhkarModal')">âœ•</span><h2 style="text-align:center; color:#8e44ad;">Ø£Ø°ÙƒØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©</h2><div id="adhkar-list">Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ (3)ØŒ Ø§Ù„Ù„Ù‡Ù… Ø£Ù†Øª Ø§Ù„Ø³Ù„Ø§Ù…..</div></div></div>
  <div id="settingsModal" class="modal"><div class="modal-content"><span class="close-modal" onclick="closeModal('settingsModal')">âœ•</span><h2 style="text-align:center;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2><button onclick="adjustHijri(1)" style="width:100%; padding:10px; margin-bottom:10px;">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ +1</button><button onclick="adjustHijri(-1)" style="width:100%; padding:10px;">ØªØ£Ø®ÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ -1</button></div></div>

  <script>
    let timerInterval, soundEnabled = true, hijriOffset = parseInt(localStorage.getItem('hijriOffset') || 0);
    window.onload = () => { updateBackground(); setInterval(updateBackground, 60000); const savedMode = localStorage.getItem('mode'); if (savedMode === 'manual') runManualSearch(); else getLocation(); };

    function getLocation() { if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p => fetchPrayerTimes(p.coords.latitude, p.coords.longitude), () => switchMode('manual')); else switchMode('manual'); }
    function fetchPrayerTimes(lat, lng, city, country) {
      let url = lat ? `https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=4` : `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=4`;
      fetch(url).then(res => res.json()).then(data => { if(data.code === 200) { displayTimes(data.data); startCountdown(data.data.timings); calculateNightTimes(data.data.timings); } });
    }

    function displayTimes(data) {
      const t = data.timings, h = data.date.hijri;
      document.getElementById('date-area').innerText = `${data.date.gregorian.date} Ù… | ${parseInt(h.day)+hijriOffset} ${h.month.ar} ${h.year} Ù‡Ù€`;
      const m = { 'Fajr': 'Ø§Ù„ÙØ¬Ø±', 'Sunrise': 'Ø§Ù„Ø´Ø±ÙˆÙ‚', 'Dhuhr': 'Ø§Ù„Ø¸Ù‡Ø±', 'Asr': 'Ø§Ù„Ø¹ØµØ±', 'Maghrib': 'Ø§Ù„Ù…ØºØ±Ø¨', 'Isha': 'Ø§Ù„Ø¹Ø´Ø§Ø¡' };
      let html = ''; for (const [k, v] of Object.entries(m)) html += `<div class="prayer-row" id="row-${k}"><span>${v}</span><span class="time">${t[k]}</span></div>`;
      document.getElementById('prayers-list-content').innerHTML = html;
    }

    function startCountdown(timings) {
      clearInterval(timerInterval); document.getElementById('countdown-area').style.display = 'block';
      const pOrder = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'], ar = {'Fajr': 'Ø§Ù„ÙØ¬Ø±', 'Dhuhr': 'Ø§Ù„Ø¸Ù‡Ø±', 'Asr': 'Ø§Ù„Ø¹ØµØ±', 'Maghrib': 'Ø§Ù„Ù…ØºØ±Ø¨', 'Isha': 'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
      timerInterval = setInterval(() => {
        const now = new Date(); let nextP = null, nextK = '';
        for (let p of pOrder) { let d = new Date(); let [h, m] = timings[p].split(':'); d.setHours(h, m, 0); if (d > now) { nextP = d; nextK = p; break; } }
        if (!nextP) { nextP = new Date(); nextP.setDate(nextP.getDate()+1); let [h, m] = timings['Fajr'].split(':'); nextP.setHours(h, m, 0); nextK = 'Fajr'; }
        document.getElementById('p-name').innerText = ar[nextK];
        const diff = nextP - now;
        const hh = Math.floor(diff/3600000), mm = Math.floor((diff%3600000)/60000), ss = Math.floor((diff%60000)/1000);
        document.getElementById('timer').innerText = `${hh < 10 ? '0'+hh : hh}:${mm < 10 ? '0'+mm : mm}:${ss < 10 ? '0'+ss : ss}`;
      }, 1000);
    }

    function calculateNightTimes(timings) {
      let maghrib = new Date(); let [mH, mM] = timings['Maghrib'].split(':'); maghrib.setHours(mH, mM, 0);
      let fajr = new Date(); fajr.setDate(fajr.getDate()+1); let [fH, fM] = timings['Fajr'].split(':'); fajr.setHours(fH, fM, 0);
      let diff = fajr - maghrib;
      let midnight = new Date(maghrib.getTime() + (diff / 2));
      let lastThird = new Date(fajr.getTime() - (diff / 3));
      let fmt = d => { let h = d.getHours() % 12 || 12; let m = d.getMinutes(); return `${h}:${m < 10 ? '0'+m : m} ${d.getHours() >= 12 ? 'Ù…' : 'Øµ'}`; };
      document.getElementById('midnight-time').innerText = fmt(midnight);
      document.getElementById('last-third-time').innerText = fmt(lastThird);
    }

    function switchMode(m) { document.getElementById('manual-input').style.display = m==='manual'?'block':'none'; localStorage.setItem('mode', m); if(m==='auto') getLocation(); }
    function runManualSearch() { fetchPrayerTimes(null, null, document.getElementById('city').value, document.getElementById('country').value); }
    function openModal(id) { document.getElementById(id).style.display = "block"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }
    function toggleSound() { soundEnabled = !soundEnabled; document.getElementById('soundBtn').innerText = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'; }
    function adjustHijri(v) { hijriOffset += v; localStorage.setItem('hijriOffset', hijriOffset); location.reload(); }
    function updateBackground() { const h = new Date().getHours(); document.body.className = h>=4&&h<6?'morning':h>=6&&h<11?'sunrise':h>=11&&h<16?'day':h>=16&&h<19?'sunset':'night'; }
  </script>
</body>
</html>