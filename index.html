<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù† - Ø£ØµÙØ±ÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #0a1a3a, #1e3c72);
      color: white;
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    h1 {
      margin: 10px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      font-size: 1.5em;
      color: #f1c40f;
    }

    p {
      color: #ccc;
      margin-bottom: 15px;
      font-size: 0.9em;
    }

    .controls {
      background: rgba(20, 30, 50, 0.9);
      padding: 15px;
      border-radius: 15px;
      width: 100%;
      max-width: 400px;
      margin-bottom: 15px;
      border: 1px solid rgba(241, 196, 15, 0.3);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      text-align: center;
      font-family: 'Tajawal', sans-serif;
      font-size: 1em;
      margin-bottom: 10px;
      background: #f8f9fa;
      color: #333;
    }

    button {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-family: 'Tajawal', sans-serif;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-generate { background: linear-gradient(45deg, #f39c12, #d35400); color: white; margin-bottom: 8px; }
    .btn-download { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; display: none; }

    canvas {
      max-width: 85%;
      max-height: 50vh;
      width: auto;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      margin-top: 5px;
      border: 2px solid #d4af37;
    }

    .footer-link { margin-top: 20px; font-size: 0.9em; opacity: 0.9; padding-bottom: 30px; }
    .footer-link a { color: #f39c12; text-decoration: none; font-weight: bold; border-bottom: 1px dashed #f39c12; }
  </style>
</head>
<body>

  <h1>Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø´Ù‡Ø± ğŸŒ™</h1>
  <p>Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù„ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ</p>

  <div class="controls">
    <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… (Ù…Ø«Ø§Ù„: Ø£Ø®ÙˆÙƒÙ… / ÙŠØ­ÙŠÙ‰ Ø§Ù„Ø£ØµÙØ±ÙŠ)">
    <button class="btn-generate" onclick="generateCard()">âœ¨ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
    <button class="btn-download" id="downloadBtn" onclick="downloadCard()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
  </div>

  <canvas id="cardCanvas"></canvas>

  <div class="footer-link">
    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ <a href="index.html">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</a>
  </div>

  <script>
    const canvas = document.getElementById('cardCanvas');
    const ctx = canvas.getContext('2d');
    const image = new Image();

    image.crossOrigin = "anonymous";
    image.src = "./ramadan-bg.png"; // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯

    let imageLoaded = false;

    image.onload = function() {
      imageLoaded = true;
      canvas.width = image.width;
      canvas.height = image.height;
      drawText("");
    };

    image.onerror = function() {
      alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù ramadan-bg.png");
    };

    function generateCard() {
      if (!imageLoaded) return alert("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ…...");
      const name = document.getElementById('nameInput').value.trim();
      if (!name) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…");

      drawText(name);
      document.getElementById('downloadBtn').style.display = 'block';

      setTimeout(() => {
        canvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 100);
    }

    // âœ… Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ø¯Ø§Ø¦Ù…Ù‹Ø§ + Ø¨Ø¯ÙˆÙ† Ù‡ÙˆØ§Ù…Ø´ Ø¥Ø¶Ø§ÙÙŠØ© + Ù…Ù†Ø¹ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù†Øµ Ø¹Ù† Ø§Ù„Ù„ÙˆØ­Ø©
    function drawText(text) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(image, 0, 0);

  // Ø§Ù„Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹
  drawFooterMark_();

  if (!text) return;

  const cleaned = String(text).replace(/\s+/g, " ").trim();

  // 1) ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (Ù„Ù„Ù€ clip ÙÙ‚Ø·)
  const plateW = canvas.width * 0.64;
  const plateH = canvas.height * 0.10;
  const plateX = (canvas.width - plateW) / 2;
  const centerY = canvas.height * 0.668;
  const plateY = centerY - (plateH / 2);

  // 2) âœ… Ù…Ù†Ø·Ù‚Ø© ÙƒØªØ§Ø¨Ø© â€œØµØ§ÙÙŠØ©â€ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø© (ØªØ³ØªØ¨Ø¹Ø¯ Ø§Ù„Ø²Ø®Ø§Ø±Ù/Ø§Ù„Ø£Ø³ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙÙŠÙ†)
  // Ø§Ù„Ø±Ù‚Ù… 0.74 Ù…Ù†Ø§Ø³Ø¨ Ø¬Ø¯Ù‹Ø§ Ø­Ø³Ø¨ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´ØªÙƒ
  const safeTextW = plateW * 0.74;

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù‚ØµÙ‘ Ø¹Ù…ÙˆØ¯ÙŠ Ø¨Ø³ÙŠØ· Ø­ØªÙ‰ Ù„Ø§ ÙŠÙ„Ù…Ø³ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠØ©/Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø©
  const safeTextH = plateH * 0.78;

  const safeX = (canvas.width - safeTextW) / 2;
  const safeY = centerY - (safeTextH / 2);

  // 3) Ù‚ØµÙ‘ Ù„Ù„Ø­Ù…Ø§ÙŠØ© (Ù†Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµØ§ÙÙŠØ© Ù†ÙØ³Ù‡Ø§ØŒ Ø£Ø¯Ù‚ Ù…Ù† Ù‚ØµÙ‘ Ø§Ù„Ù„ÙˆØ­Ø© ÙƒØ§Ù…Ù„Ø©)
  ctx.save();
  ctx.beginPath();
  ctx.rect(safeX, safeY, safeTextW, safeTextH);
  ctx.clip();

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ
  ctx.fillStyle = "#4b3621";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  // 4) Ø¨Ø­Ø« Ø«Ù†Ø§Ø¦ÙŠ Ù„Ø£ÙƒØ¨Ø± Ø­Ø¬Ù… Ø®Ø· ÙŠØ¯Ø®Ù„ Ø¶Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµØ§ÙÙŠ
  const maxFont = Math.floor(canvas.width / 12);
  const minFont = 8;

  let lo = minFont, hi = maxFont, best = minFont;

  while (lo <= hi) {
    const mid = Math.floor((lo + hi) / 2);
    ctx.font = `bold ${mid}px 'Tajawal', sans-serif`;
    const w = ctx.measureText(cleaned).width;

    if (w <= safeTextW) {
      best = mid;
      lo = mid + 1;
    } else {
      hi = mid - 1;
    }
  }

  // 5) Ø±Ø³Ù… Ø§Ù„Ù†Øµ
  ctx.font = `bold ${best}px 'Tajawal', sans-serif`;
  const centerX = canvas.width / 2;
  ctx.fillText(cleaned, centerX, centerY);

  ctx.restore();
}


    function drawFooterMark_() {
      const adFontSize = Math.floor(canvas.width / 45);
      ctx.font = `${adFontSize}px 'Tajawal', sans-serif`;
      ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
      ctx.textAlign = "left";
      ctx.textBaseline = "alphabetic";
      ctx.fillText("asfari.net", canvas.width * 0.08, canvas.height - (canvas.height * 0.05));
    }

    function downloadCard() {
      try {
        const link = document.createElement('a');
        const name = document.getElementById('nameInput').value.trim() || "Ramadan";
        link.download = `ØªÙ‡Ù†Ø¦Ø©-Ø±Ù…Ø¶Ø§Ù†-${name}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (e) {
        alert("Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø­ÙØ¸Ù‡Ø§.");
      }
    }
  </script>

</body>
</html>
